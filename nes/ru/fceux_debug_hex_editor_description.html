<!DOCTYPE html>
<html>

<head>
<meta http-equiv="Content-Type" content="text/html">
<meta charset="UTF-8">
<meta name="description" content="new">

<title>FCEUX: Hex Editor. Описание окна</title>
<link rel="icon" href="../favicon.png" type="image/png">
<link href="../style.css" rel="stylesheet">
</head>

<body>

<h1>FCEUX: Hex Editor. Описание окна</h1>
<p>
<center><a href="./index.html">Вернуться на главную страницу</a></center>
</p>
<br>

<br>
<p class="title">Содержание</p>
<ul>
<li>Описание окна</li>
<li>Вкладка View</li>
<li>Возможности окна</li>
</ul>

<br>
<h2>Описание окна</h2>

<p>
Окно открывается в Debug -> Hex Editor, или горячей клавишей. Если ROM не запущен в эмуляторе, окно открыть не получится. Окно автоматически закрывается при закрытии ROM'а.

<p>
<img src="../images/0001.png">
</p>

<p>
По умолчанию открыто View -> NES Memory. Окно можно растянуть мышкой по размеру, и перемещаться по нему при помощи стрелок на клавиатуре или колесом мышки (как в браузере). 
</p>

<p>
Слева находятся начальные адреса строки.
</p>

<p>
<img src="../images/0005.png">
</p>

<p>
В середине в каждой строке по 16 адресов, в каждом адресе 1 байт. Переменные в адресах при запуске ROM'а зависят от опции эмулятора Config -> RAM Init.
</p>

<p>
<img src="../images/0006.png">
</p>

<p>
Справа отображена кодировка байтов, по умолчанию ASCII. Кодировку можно изменить, подготовив .tbl файл и подгрузив его через File -> Load *.TBL File. Выбранный байт подсвечивается и в кодировке справа.
</p>

<p>
<img src="../images/0007.png">
</p>

<p>
Выбранный адрес отображается в названии окна (без лишних нулей слева и с префиксом 0x), а также указан тип памяти этого адреса, в зависимости от режима вкладки View и самого адреса.
</p>

<p>
<img src="../images/0003.png">
</p>

<p>
При выделении мышкой сразу нескольких адресов, в названии окна будет указан выделенный диапазон адресов, а также шестнадцатеричное количество выделенных байтов.
</p>

<p>
<img src="../images/0004.png">
</p>

<br>
<h2>Вкладка View</h2>

<p>
Можно переключиться на 4 разных режима.
</p>

<p>
<img src="../images/0002.png">
</p>

<h3>NES Memory</h3>

<p>
Здесь расположена память процессора. Включает в себя RAM, регистры, батарейку (при ее наличии) и память ROM'а, подгруженную из ROM File. Размер окна $0000-$FFFF.
</p>

<h3>PPU Memory</h3>

<p>
Здесь расположена память видеопроцессора. Включает в себя графику фона и спрайтов, атрибуты фона и палитру. Размер окна $0000-$3FFF.
</p>

<h3>OAM Memory</h3>

<p>
Здесь расположена память спрайтов. Включает в себя копию данных всех 64 спрайтов из NES Memory, обычно из адресов $0200-$02FF. Размер окна минимум $0000-$00FF, дальнейшее увеличение окна лишь отображает копию $0000-$00FF.
</p>

<h3>ROM File</h3>

<p>
Здесь расположены байты из ROM'а. ROM File является аналогией открытия ROM'а в любом другом Hex-редакторе. Включает в себя хедер, память PRG ROM и CHR ROM (при наличии). При отсутствии CHR ROM, последние 8 килобайт отображают копию $0000-$01FF из PPU Memory. Размер окна зависит от размера ROM'а и наличия CHR.
</p>

<br>
<h2>Окно Hex Editor</h2>

<p>
Для примера будет использоваться игра Battle City (J) [!].nes. Запусти игру, затем в эмуляторе нажми Debug -> Hex Editor.
</p>

<h3>Описание окна</h3>

<p>
Окно отображает данные игры на данный момент. Данные обновляется 1 раз за кадр.
</p>

<h3>Вкладка View</h3>

<p>
В этой вкладке можно переключаться на 4 разных режима.
</p>

<h4>NES Memory</h4>

<p>
Это память процессора. Здесь находится <text class="object">RAM</text> (оперативная память), регистры, батарейка (при наличии) и данные из ROM File. Размер NES Memory $0000-$FFFF, и процессор может работать с любыми адресами в этом диапазоне, считывая и записывая байты.
</p>

<button class="spoiler">Карта RAM</button>
<div class="panel">
<p>
<li>$0000-$00FF - нулевая страница памяти (Zero Page). Это самые ценные адреса во всей RAM, поскольку обращение к ним занимает у процессора меньше времени, чем ко всем остальным, поэтому игры обычно располагают здесь наиболее важные и часто используемые данные. Адреса с кнопками джойстиков почти наверняка будут здесь.</li>
<li>$0100-$01FF - адреса стека, необходимые в первую очередь для хранения адресов возврата из подпрограмм. Стек всегда будет находиться по этим адресам во всех играх, про него поговорим в разделе с командами процессора.</li>
<li>$0200-$02FF - чаще всего игры хранят здесь атрибуты спрайтов, и в Battle City тоже. Эти адреса очень легко найти по внешнему виду, особенно когда на экране много движущихся объектов. Для спрайтов всегда выделено 16 строчек. Подробнее узнаешь в разделе с графикой.</li>
<li>$0300-$06FF - тут может быть что угодно, обычно это адреса с координатами объектов и прочие их характеристики. Данные уровня тоже чаще всего расположены в этом диапазоне.</li>
<li>$0700-$07FF - здесь могут быть адреса, выделенные для игрового музыкального движка. Такие адреса в принципе тоже легко находимы, если просто стоять в игре на месте, слушать музыку и просматривать RAM.</li>
</p>

<p>
Адреса $0200-$07FF представляют собой одинаковую ценность, поэтому игры обычно хранят здесь что-то второстепенное. В Battle City музыка находится в $0300-$03FF, а $0400-$07FF это данные уровня (кирпичи, вода и все остальное).
</p>
</div>
<br>

<button class="spoiler">Карта NES Memory</button>
<div class="panel">
<p>
$0000-$07FF - основная RAM. Дальше идут 3 зеркала $0800-$1FFF. Например, у адреса $0000 есть 3 зеркала - $0800, $1000 и $1800. Если что-то записать в основной адрес, это отобразится в зеркалах, и наоборот. Но тебе предстоит работать только с оригиналом.
</p>
</div>
<br>

<h4>PPU Memory</h4>

<p>
Это видеопамять. Здесь находится графика, атрибуты фона и палитра. Процессор общается с видеопамятью через регистры, что позволяет ему считывать и записывать байты.
</p>

<button class="spoiler">Больше информации</button>
<div class="panel">
<p>

</p>
</div>
<br>

<h4>OAM Memory</h4>

<p>
Это память спрайтов. Здесь показаны данные для каждого из 64-х спрайтов. Технически память спрайтов находится в RAM, а это окно лишь отображает именно ту область RAM, которая отвечает за память спрайтов.
</p>

<p>
Размер памяти спрайтов в этом окне $0000-$00FF, а все что ниже лишь зеркала (копии).
</p>

<h4>ROM File</h4>

<p>
Память ROM'а. Здесь показан ROM, как если бы ты открыл его в любом другом Hex-редакторе. Здесь находится хедер, Аналогично тому, что ты откроешь игру в любом другом Hex-редакторе. За исключением самой первой строчки, любые другие байты можно изменять в реальном времени, внося изменения в код игры и в другие данные.
</p>

<h3>Возможности окна</h3>

<button class="spoiler">Сохранятся ли изменения в игре, которые я делаю в RAM?</button>
<div class="panel">
<p>
Нет. Изменяя байты в RAM, ты делаешь лишь временные изменения.
</p>

<p>
Чтобы сохранить свои изменения, потребуется сделать хак игры, то есть отредактировать код таким образом, чтобы он вносил нужные тебе изменения в RAM.
</p>
</div>
<br>

<br>
<h2>Список адресов Battle City</h2>

<p>
Здесь приведены некоторые игровые адреса, 
</p>

<br>
<h2>Заключение</h2>

<button class="spoiler">Как мне самостоятельно найти адреса в своей игре?</button>
<div class="panel">
<p>
Существует несколько способов поиска адресов, которые будут описаны в отдельной статье.
</p>

<p>
Пока что можешь попробовать поискать адреса просто наблюдая за RAM.
</p>
</div>
<br>

<br>
<br>
<br>

<script src="../spoiler.js"></script>

</body>

</html>