<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html">
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<title>ЯРомхакеръ. Ромхакинг NES. Введение в ромхакинг NES. Центральный процессор</title>
		<meta name="description" content="Краткое описание процессора 6502">
		<meta name="keywords" content="">
		<link rel="icon" href="https://iromhacker.ru/favicon.png" type="image/png">
		<link href="https://iromhacker.ru/style.css" rel="stylesheet">
		<script src="https://iromhacker.ru/analytics.js"></script>
	</head>
	<body>
		<h1>Центральный процессор</h1>
		<p>
			<center>
				<a href="https://iromhacker.ru/nes/ru/index.html">Вернуться на главную страницу</a>
			</center>
		</p>
		<p>
			<center>
				<a href="https://translate.google.com/translate?sl=ru&tl=en&u=https://iromhacker.ru/nes/ru/tutorials/2/2/index.html" target="_blank">Translate this page into English</a>
			</center>
		</p>
		<br>
		<p class="title">
			Содержание
		</p>
		<ul>
			<li><a href="../1/index.html">Nintendo Entertainment System</a></li>
			<li>Центральный процессор</li>
			<li><a href="../3/index.html">Графический процессор</a></li>
			<li><a href="../4/index.html">Звуковой процессор</a></li>
			<li><a href="../5/index.html">Системы счисления</a></li>
		</ul>
		<h2>Процессор</h2>
		<p>
			Центральным процессором (CPU) является 8-битный микропроцессор на основе MOS Technology 6502.
		</p>
		<p>
			Размер памяти процессора = 64 KB. Каждая ячейка памяти называется "адрес", в каждом адресе хранится 1 байт. В статьях адреса будут записаны четырьмя символами с префиксом "$".
		</p>
		<p>
			64 KB = диапазон адресов $0000-$FFFF. У процессора 16-битная адресная шина, что позволяет ему обращаться к любому адресу этого диапазона.
		</p>
		<p>
			<img src="https://i.imgur.com/KL6EMU4.gif"><!--0010-->
		</p>
		<p>
			Память разбита на несколько участков. Самыми примечательными являются RAM и PRG ROM. Остальные адреса это зеркала RAM, память батарейки (при ее наличии) и различные регистры (включая их зеркала).
		</p>
		<h3>RAM</h3>
		<p>
			Оперативная память размером 2 KB, она находится в диапазоне $0000-$07FF. RAM служит для хранения данных игрового процесса, например количества жизней, координат игроков, номер уровня, таймеров и прочее.
		</p>
		<p>
			<img src="https://i.imgur.com/EkmKh08.gif"><!--0011-->
		</p>
		<p>
			Чтобы внести в игру некие изменения, нужно повлиять на адрес, который отвечает за необходимую игровую функцию.
		</p>
		<h3>PRG ROM</h3>
		<p>
			Программа размером 32 KB в диапазоне $8000-$FFFF. Сюда подключаются банки PRG (части памяти из файла ROM'а). В них размещен код и игровые данные, например текст, таблица уровней, параметры персонажей и другие.
		</p>
		<p>
			<img src="1.png">
		</p>
		<p>
			Большинству игр недостаточно 32-х KB памяти, поэтому они могут подключать в эту область другие банки, причем по нескольку раз за кадр. Обычно крупные игровые программы, такие как отрисовка графики, вычисление физики, музыкальный движок и другие, находятся в отдельных банках и подключаются в том порядке, в котором запрограммирован основной игровой скрипт.
		</p>
		<p class="tip">
			Возможность и метод переключения банков памяти зависят от маппера игры.
		</p>
		<h2>Программирование на NES</h2>
		<p>
			Игры для NES написаны на языке ассемблера процессора 6502. Это низкоуровневый язык программирования, в котором программа является байт-кодом. Эти байты интерпретируются как набор команд.
		</p>
		<p>
			<img src="2.png">
		</p>
		<p class="tip">
			Предназначение данной подпрограммы - записать байт #$0F по адресам $00CF-$00DF и $0427-$0437.
		</p>
		<p>
			Точкой входа в программу (игру) является 16-битный адрес, младший и старший байт которого указаны в $FFFC-$FFFD. Затем происходит базовая загрузка игры, такая как отрисовка различных игровых экранов и заставок. Дальнейшие игровые события развиваются благодаря нажатию кнопок на джойстике.
		</p>
		<p>
			Редактируя код игры, можно изменять геймплей и игровые данные. Для этого требуется знание команд и регистров процессора.
		</p>
		<br>
		<br>
		<br>
		<script src="https://iromhacker.ru/spoiler.js"></script>
	</body>
</html>