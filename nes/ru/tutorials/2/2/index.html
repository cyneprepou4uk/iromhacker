<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html">
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<title>ЯРомхакеръ. Ромхакинг NES. Введение в ромхакинг NES. Центральный процессор</title>
		<meta name="description" content="Краткое описание процессора 6502">
		<meta name="keywords" content="">
		<link rel="icon" href="https://iromhacker.ru/favicon.png" type="image/png">
		<link href="https://iromhacker.ru/style.css" rel="stylesheet">
		<script src="https://iromhacker.ru/analytics.js"></script>
	</head>
	<body>
		<h1>Центральный процессор</h1>
		<p>
			<center>
				<a href="https://iromhacker.ru/nes/ru/index.html">Вернуться на главную страницу</a>
			</center>
		</p>
		<p>
			<center>
				<a href="https://translate.google.com/translate?sl=ru&tl=en&u=https://iromhacker.ru/nes/ru/tutorials/2/2/index.html" target="_blank">Translate this page into English</a>
			</center>
		</p>
		<br>
		<p class="title">
			Содержание
		</p>
		<ul>
			<li><a href="../1/index.html">Nintendo Entertainment System</a></li>
			<li>Центральный процессор</li>
			<li><a href="../3/index.html">Графический процессор</a></li>
			<li><a href="../4/index.html">Звуковой процессор</a></li>
			<li><a href="../5/index.html">Системы счисления</a></li>
		</ul>
		<h2>Процессор</h2>
		<p>
			Центральным процессором (CPU) является 8-битный микропроцессор на основе MOS Technology 6502.
		</p>
		<p>
			Размер памяти процессора = 64 KB. Каждая ячейка памяти называется "адрес", в каждом адресе хранится 1 байт. В статьях адреса будут записаны четырьмя символами с префиксом "$".
		</p>
		<p>
			64 KB = диапазон адресов $0000-$FFFF. У процессора 16-битная адресная шина, что позволяет ему обращаться к любому адресу этого диапазона.
		</p>
		<p>
			<img src="https://i.imgur.com/KL6EMU4.gif"><!--0010-->
		</p>
		<p>
			Память разбита на несколько участков. Самыми примечательными являются RAM и PRG ROM. Остальные адреса это зеркала RAM, память батарейки (при ее наличии) и различные регистры (включая их зеркала).
		</p>
		<h3>RAM</h3>
		<p>
			Оперативная память размером 2 KB, она находится в диапазоне $0000-$07FF. RAM служит для хранения динамических данных игрового процесса, таких как количество жизней, координаты объектов, номер уровня, таймеры и прочее. Обычно адрес RAM хранит в себе числовое количество чего-либо.
		</p>
		<p>
			<img src="https://i.imgur.com/EkmKh08.gif"><!--0011-->
		</p>
		<p>
			Каждый отдельный адрес из этих 2048-ми адресов может отвечать за какую-то определенную задачу, или же просто быть свободным (который совсем не используется игрой). Некоторые схожие адреса, например координаты объектов, очень часто находятся по соседству.
		</p>
		<p class="tip">
			Только разработчики игры решают за что будет отвечать каждый из этих адресов, и скорее всего адрес, который отвечает за какую-то функцию, в другой игре будет находиться в совершенно другом месте. Схожее расположение адресов в лучшем случае ты встретишь у игр одной серии, или в играх одной и той же компании.
		</p>
		<p>
			Несмотря на такое большое количество адресов, найти нужный адрес, который отвечает за определенную игровую функцию, не так уж и сложно.
		</p>
		<p>
			Чтобы внести в игру некие изменения, нужно повлиять на адрес, который отвечает за соответствующую игровую функцию. Свободные адреса можно использовать самому для хранения каких-то новых динамических данных.
		</p>
		<h3>PRG ROM</h3>
		<p>
			Программа размером 32 KB в диапазоне $8000-$FFFF. Здесь размещен код и игровые данные, например текст, таблица уровней, параметры персонажей и другие. Большинство статичных данных и констант будут храниться именно здесь. Динамические данные находятся в адресах RAM.
		</p>
		<p>
			<img src="1.png">
		</p>
		<p>
			Однако крупным играм недостаточно 32 KB памяти, и тогда на помощь приходит маппер. Он позволяет подключать в эту область различные "банки" памяти из файла ROM'а, таким образом в том же диапазоне $8000-$FFFF в другой момент времени может мгновенно оказаться совершенно иной код с данными.
		</p>
		<p class="tip">
			Возможность, метод переключения банков памяти и их размер зависят от маппера.
		</p>
		<p>
			Обычно массивные игровые программы, такие как отрисовка графики, вычисление физики, музыкальный движок и другие, находятся в отдельных банках и подключаются на протяжении кадра в том порядке, в котором запрограммирован основной игровой скрипт.
		</p>
		<h2>Программирование на NES</h2>
		<p>
			Игры для NES написаны на языке ассемблера процессора 6502. Это низкоуровневый язык программирования, в котором программа является байт-кодом. Эти байты интерпретируются как набор команд.
		</p>
		<p>
			<img src="2.png">
		</p>
		<p class="tip">
			Предназначение данной подпрограммы - записать байт #$0F по адресам $00CF-$00DF и $0427-$0437.
		</p>
		<p>
			Точкой входа в программу (игру) является 16-битный адрес, младший и старший байт которого указаны в $FFFC-$FFFD. Затем происходит базовая загрузка игры, такая как отрисовка различных игровых экранов и заставок. Дальнейшие игровые события развиваются благодаря нажатию кнопок на джойстике.
		</p>
		<p>
			Редактируя код игры, можно изменять геймплей и игровые данные. Для этого требуется знание команд и регистров процессора.
		</p>
		<br>
		<br>
		<br>
		<script src="https://iromhacker.ru/spoiler.js"></script>
	</body>
</html>