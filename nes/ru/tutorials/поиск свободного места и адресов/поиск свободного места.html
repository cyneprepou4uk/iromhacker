<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html">
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<title>Ромхакинг NES. Поиск свободного места</title>
		<meta name="description" content="">
		<meta name="keywords" content="">
		<link rel="icon" href="https://iromhacker.ru/favicon.png" type="image/png">
		<link href="https://iromhacker.ru/style.css" rel="stylesheet">
		<script src="https://iromhacker.ru/analytics.js"></script>
	</head>
	<body>
		<h1>Поиск свободного места</h1>
		<h2>Поиск свободного места</h2>
		<p>
			Свободным местом являются локации в ROM File, в которых находятся байты #$00 или #$FF.
		</p>
		<p>
			В более редких случаях это может быть всякий хлам, наподобие иероглифов в танчиках. Также это может быть куча однотипных байтов, например #$55.
		</p>
		<p>
			Чтобы проверить свободно ли это место, нужно воспользоваться окном Code/Data Logger и пройти игру со включенным логгером используемых байтах. Еще можно поставить брейкпоинты на чтение этих байтов.
		</p>
		<p>
			Даже если свободное место найдено, не факт что его можно использовать в данный момент. Если игра переключает банки PRG, банк со свободным местом может быть не активен в то время, как выполняется код, который ты собираешься отредактировать. Нужно посмотреть подключенные банки в момент выполнения кода, поставив на нем брейкпоинт.
		</p>
		<p>
			В редких случаях доступный банк со свободным местом может быть недоступен в какой-то другой игровой момент. Чтобы убедиться вв безопасности использования свободного места, создай примитивную подпрограмму, которая ничего не будет делать, кроме как выполнять код, который ты заменишь на JSR, и в конце поставь RTS. Далее нужно поиграть и проверить нету ли проблем с игрой из-за использования твоей подпрограммы.
		</p>
		<p>
			Можно обойтись и без подключения подпрограммы. Можно изучить банки, и найти какой-то особый адрес, в котором каждый раз будет находиться разный байт из-за разного подключения банков. Далее ты ставишь на месте выполнения Execute брейкпоинт с условием, что байт в этом адресе должен быть не равен найденному значению. Если игра вдруг выполнит код, который ты будешь редактировать, и в это время в адресе будет находиться другой байт, значит эту проблему нужно решать по-другому.
		</p>
		<p>
			Если ты знаком с маппером игры и умеешь переключать банки PRG, у тебя не будет особых проблем с выделением свободного места.
		</p>
		<p>
			Если свободного места нету, но маппер позволяет расширить размер PRG ROM, сделай это и воспользуйся новым свободным местом при помощи переключения банков.
		</p>
		<p>
			В самом худшем случае, когда совсем нету места, для выделения свободного места можно вырезать какую-то не слишком полезную функцию, высвободив байты под свой код. Пожалуй, одна из самых бесполезных функций игры - демо-режим, в которой компьютер сам управляет своим персонажем. Если нету демо-режима, пожно пожертвовать каким-нибудь логотипом или частью диалога.
		</p>
		<p>
			Или можно перевести игру на другой маппер, чтобы расширить PRG ROM и подключить новые банки.
		</p>
		<script src="https://iromhacker.ru/spoiler.js"></script>
		<script src="https://iromhacker.ru/tab.js"></script>
	</body>
</html>