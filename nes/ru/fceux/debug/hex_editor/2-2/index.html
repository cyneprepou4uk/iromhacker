<!DOCTYPE html>
<html>

	<head>
		<meta http-equiv="Content-Type" content="text/html">
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<title>ЯРомхакеръ. Ромхакинг NES. Hex Editor. PPU Memory</title>
		<meta name="description" content="Описание режима отображения памяти PPU Memory эмулятора FCEUX">
		<meta name="keywords" content="">
		<link rel="icon" href="https://iromhacker.ru/favicon.png" type="image/png">
		<link href="https://iromhacker.ru/style.css" rel="stylesheet">
		<script src="https://iromhacker.ru/analytics.js"></script>
		<script src="https://iromhacker.ru/bitrix24.js" async></script>
	</head>
	<body>
		<h1>PPU Memory</h1>
		<p>
			<center>
				<a href="https://iromhacker.ru/nes/ru/index.html">Вернуться на главную страницу</a>
			</center>
		</p>
		<br>
		<br>
		<p class="title">
			Содержание
		</p>
		<ul>
			<li><a href="../1/index.html">Описание окна Hex Editor</a></li>
			<li><a href="../2/index.html">Вкладка View</a></li>
			<ul>
				<li><a href="../2-1/index.html">NES Memory</a></li>
				<ul>
					<li><a href="../2-1-1/index.html">Заморозка адресов</a></li>
				</ul>
				<li>PPU Memory</li>
				<li><a href="../2-3/index.html">OAM Memory</a></li>
				<li><a href="../2-4/index.html">ROM File</a></li>
			</ul>
			<li><a href="../3/index.html">Прочие возможности окна</a></li>
			<ul>
				<li><a href="../3-1/index.html">Закладки</a></li>
				<li><a href="../3-2/index.html">Поиск</a></li>
				<li><a href="../3-3/index.html">Файл .tbl</a></li>
			</ul>
		</ul>
		<h2>PPU Memory</h2>
		<p>
			Этот режим отображает память видеопроцессора. Размер окна $0000-$3FFF.
		</p>
		<p>
			На адреса PPU можно ставить Read и Write брейкпоинты, кликнув правой кнопкой по адресу (или выделенному диапазону).
		</p>
		<p>
			<img src="1.png">
		</p>
		<p>
			Так как чтение/запись байтов видеопамяти осуществляется через регистр $2006, все брейкпоинты будут срабатывать на командах, работающих с адресом $2006, когда код будет пытаться считать или записать байт по адресу, указанному в условии брейкпоинта.
		</p>
		<p class="tip">
			Подробности о брейкпоинтах читай в описании окна Debugger.
		</p>
		<h3>Pattern table</h3>
		<p>
			По адресам $0000-$1FFF находятся байты CHR, из которых составляется изображение тайла. Тайлы можно посмотреть в окне PPU Viewer, которое открывается в эмуляторе FCEUX во вкладке Debug.
		</p>
		<p>
			Каждая из двух таблиц Pattern table размером 4 KB (диапазоны $0000-$0FFF и $1000-$1FFF). Одна из них отвечает за тайлы, а другая за спрайты. Это контролируется регистром видеопроцессора $2000. 
		</p>
		<p>
			Если маппер позволяет переключать банки с тайлами, нельзя вручную изменять байты в этом диапазоне, если не знаешь что делаешь. Для редактирования этих байтов есть тайловые редакторы, например YY-CHR.
		</p>
		<p class="tip">
			Изменив эти байты вручную, ты начнешь изменять изображение тайлов. Эти изменения занесутся напрямую в CHR ROM, и их нельзя будет отменить ни через Ctrl + Z, ни загрузкой сохранения. А если сохранить ROM во вкладке File, изменения окончательно сохранятся в файле. Восстановить можно будет лишь воспользовавшись предварительно сделанной копией файла, скопировав оттуда байты и вставив по нужному месту в подпорченном файле.
		</p>
		<p class="tip">
			Если сильно накосячить в своем коде, может случиться такое, что он начнет записывать байты в видеопамять и перерисовывать тайлы.
		</p>
		<p class="tip">
			Нельзя выловить попытку игры переключить банк CHR ROM с помощью Write брейкпоинта на адрес PPU $0000-$1FFF, поскольку технически переключение банка не является перезаписью некого диапазона адресов другими байтами. Нужно ставить Write брейкпоинт на регистр маппера, через который осуществляется переключение банка.
		</p>
		<h3>Nametable</h3>
		<p>	
			Nametable - таблица, в которой находятся данные фона, который ты видишь в игре на экране эмулятора. С помощью них рисуется уровень, по которому проходит персонаж.
		</p>
		<p>
			Каждая из 4-х таблиц  размером 1 KB. Первая таблица в диапазоне $2000-$23FF, вторая $2400-27FF, третья $2800-$2BFF, четвертая $2C00-$2FFF. Их можно посмотреть в окне Name Table Viewer, которое открывается в эмуляторе FCEUX во вкладке Debug.
		</p>
		<p>
			В большинстве случаев есть 2 основных таблицы и 2 их зеркала. Тип зеркаливания контролируется регистром маппера, отвечающим за Mirroring, либо хедером. При Horizontal Mirroring зеркалом 1-й таблицы является 2-я, а при Vertical - 3-я.
		</p>
		<p class="tip">
			Mirroring по большей части выбирается исходя из того, как именно будет скроллиться игровой экран.
		</p>
		<p>
			Первые 960 байтов таблицы являются номерами тайлов, а последние 64 байта являются атрибутом заднего фона, в котором указывается палитра для размера 32x32 пикселя. Если взять в пример первую таблицу, то номера тайлов находятся в $2000-$23BF, а атрибуты в $23C0-$23FF.
		</p>
		<p class="tip">
			У игр региона NTSC не отображаются верхние и нижние 8 пикселей экрана. Это можно временно изменить в Config -> Video -> Drawing area. Но лучше в итоге оставить как есть.
		</p>
		<p>
			Изменяя байты в этих адресах, можно временно перерисовывать фон и изменять номер используемой палитры. Это поможет определить адрес, в котором находится нужный тайл, чтобы впоследствие поставить на него брейкпоинт. Также это помогает временно вручную сконструировать новый экран/логотип, работая с Nametable как с черновиком.
		</p>
		<p class="tip">
			Пользуйся сохранениями, чтобы вернуть байты в Nametable как было, или чтобы сравнить несколько вариантов переделанного фона.
		</p>
		<h3>Палитра</h3>
		<p>
			Палитра фона находится в $3F00-$3F0F, палитра спрайтов в $3F10-$3F1F. Все остальное это их зеркала. Цвета можно посмотреть в окне PPU Viewer (вкладка Debug).
		</p>
		<p>
			Меняя байты палитры, на экране также будут меняться цвета. Изменяя байт в $3F00 или $3F10, ты изменишь палитру фона.
		</p>
		<p class="tip">
			Иногда игра может сразу перезаписать цвета на свои, если постоянно записывает палитру в видеопамять. В таком случае они скорее всего находятся в RAM, достаточно воспользоваться поиском и пробить по нему несколько байтов, например из адресов $3F01-$3F04, а затем менять байты уже в RAM.
		</p>
		<script src="https://iromhacker.ru/spoiler.js"></script>
	</body>
</html>