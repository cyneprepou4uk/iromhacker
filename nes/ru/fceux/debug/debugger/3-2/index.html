<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html">
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<title>Ромхакинг NES. Прочие типы брейкпоинтов в Debugger'е</title>
		<meta name="description" content="Как ставить условия на такты, циклы, команды, неправильные инструкции. How to set conditions on cycles and bad instructions">
		<meta name="keywords" content="">
		<link rel="icon" href="https://cyneprepou4uk.github.io/iromhacker/favicon.png" type="image/png">
		<link href="https://cyneprepou4uk.github.io/iromhacker/style.css" rel="stylesheet">
		<script src="https://cyneprepou4uk.github.io/iromhacker/analytics.js"></script>
	</head>
	<body>
		<h1>Прочие типы брейкпоинтов</h1>
		<p>
			<center>
				<a class="return" href="https://cyneprepou4uk.github.io/iromhacker/nes/ru/index.html">Вернуться на главную страницу</a>
			</center>
		</p>
		<p class="content">
			Содержание
		</p>
		<ul>
			<li><a href="../1/index.html">Окно Debugger</a></li>
			<li><a href="../2/index.html">Регистры и флаги</a></li>
			<li><a href="../3/index.html">Брейкпоинты</a></li>
			<ul>
				<li><a href="../3-1/index.html">Создание брейкпоинтов</a></li>
				<ul>
					<li><a href="../3-1-1/index.html">Типы брейкпоинтов</a></li>
					<li><a href="../3-1-2/index.html">Дополнительные условия</a></li>
				</ul>
				<li>Прочие типы брейкпоинтов</li>
			</ul>
			<li><a href="../4/index.html">Кнопки для отладки кода</a></li>
			<li><a href="../5/index.html">Добавление комментариев</a></li>
			<ul>
				<li><a href="../5-1/index.html">Файлы комментариев</a></li>
			</ul>
			<li><a href="../6/index.html">Редактирование кода и данных</a></li>
			<li>Прочая информация в окне и его возможности</li>
		</ul>
		<h2>Прочие типы брейкпоинтов</h2>
		<p>
			Эти условия выставляются отдельно в окне Debugger'а, а не в окне создания брейкпоинта. Они не отображаются в общем списке брейкпоинтов. Состояние галочек хранится в файле .deb.
		</p>
		<p>
			<table class="tab" border=1 cellspacing=1 cellpadding=5>
				<tr>
					<td class="tabLink" onclick="openTab(event, 'Bad')">Break on Bad Opcodes</td>
					<td class="tabLink" onclick="openTab(event, 'Counters')">Условия на счетчики</td>
					<td class="tabLink" onclick="openTab(event, 'Buttons')">Кнопки</td>
				</tr>
			</table>
		</p>
		<p>
			<div id="Bad" class="tabcontent">
				<h2>Break on Bad Opcodes</h2>
				<p>
					Брейкпоинт рекомендуется для регулярного использования новичками. Галочка находится под списком брейкпоинтов.
				</p>
				<p>
					<img src="1.png">
				</p>
				<p>
					Условие данного брейкпоинта - приостановить эмуляцию при попытке выполнить UNDEFINED инструкцию. Обычно это байт #$FF.
				</p>
				<p>
					<img src="2.png">
				</p>
				<p class="tip">
					Поскольку неофициальные инструкции процессора также отображаются как UNDEFINED, на них тоже будет срабатывать этот брейкпоинт, даже если код игры работает без ошибок. Но такие встречаются очень редко.
				</p>
				<p>
					Этот тип брейкпоинта подходит для тестирования своего кода, чтобы убедиться, что прыжки и условные переходы были записаны верно. Также поможет заметить ошибку в коде из-за неправильно подключенного номера банка PRG. Если брейкпоинт срабатывает во время игры, то даже когда в геймплее багов не заметно, в коде явно что-то не в порядке.
				</p>
				<p class="tip">
					Брейкпоинт не всегда помогает найти неправильно записанную инструкцию, поскольку даже кривой прыжок может перейти на опкод, который будет распознан Debugger'ом как один из известных ему, и брейкпоинт не сработает. Но в любом случае данный брейкпоинт увеличит твои шансы в поисках бага.
				</p>
			</div>
		</p>
		<p>
			<div id="Counters" class="tabcontent">
				<h2>Условия на счетчики</h2>
				<p>
					CPU cycles - счетчик тактов, Instructions - счетчик выполненных инструкций. Оба счетчика находятся под флагами.
				</p>
				<p>
					<img src="3.png">
				</p>
				<p>
					Число рядом со счетчиком отображает его накрутку с момента его последнего обнуления.
				</p>
				<p>
					<img src="5.png">
				</p>
				<p class="tip">
					Даже если окно Debugger'а ни разу не было открыто после запуска эмулятора, счетчики все равно будут накручиваться в процессе эмуляции игры.
				</p>
				<p>
					Число в скобках отображает его накрутку с момента последней паузы эмулятора через Debugger.
				</p>
				<p>
					<img src="6.png">
				</p>
				<p class="tip">
					Например, можно будет посмотреть количество выполненных инструкций между двумя срабатываниями брейкпоинтов.
				</p>
				<p>
					Кнопка Reset counters обнуляет все показания обоих счетчиков.
				</p>
				<p>
					<img src="4.png">
				</p>
				<p class="tip">
					Счетчики автоматически обнуляются после Soft Reset и Hard Reset, а также при первом запуске игры.
				</p>
				<h3>CPU cycles</h3>
				<p>
					Выполнение одной инструкции занимает у процессора от 2-х до 6-ти тактов. При выполнении инструкци счетчик будет увеличиваться на то число, сколько тактов потребовалось у процессора на выполнение этой инструкци.
				</p>
				<p class="tip">
					Один кадр длится примерно 30.000 тактов (для PAL примерно 33.500), потом начинается следующий кадр. Если один из твоих брейкпоинтов в списке срабатывает ежекадрово, то количество тактов между срабатываниями поможет это подтвердить.
				</p>
				<p class="tip">
					С помощью просмотра данных счетчика тактов можно оценить нагрузку определенной части кода на процессор.
				</p>
				<p>
					Чтобы выставить условие на количество тактов, эмулятор должен стоять на паузе, затем нужно обнулить счетчик. Далее в поле ввода ты указываешь нужное количество тактов, и ставишь галочку.
				</p>
				<p>
					<img src="7.png">
				</p>
				<p>
					После этого снимаешь эмулятор с паузы. Debugger остановит эмуляцию игры в том случае, когда выполненные инструкции накрутят 1000 или более тактов. Количество тактов будет выделено синим, сообщая, что сработало условие данного брейкпоинта.
				</p>
				<p>
					<img src="9.png">
				</p>
				<p class="tip">
					Прежде чем снять эмулятор с паузы, нужно деактивировать галочку. Иначе эмулятор при попытке сняться с паузы просто выполнит следующую инструкцию и снова встанет на паузу, поскольку условие брейкпоинта "приостановить эмуляцию при достижении >= тактов в условии" будет продолжать действовать постоянно с активной галочкой.
				</p>
				<h3>Instructions</h3>
				<p>
					Счетчик выполненных инструкций будет просто увеличиваться на 1 после каждой выполненной инструкции. На него можно ставить условие точно также, как и на счетчик тактов, и работать он будет по такому же принципу.
				</p>
				<p class="tip">
					Этот счетчик гораздо менее полезен по сравнению со счетчиком тактов.
				</p>
			</div>
		</p>
		<p>
			<div id="Buttons" class="tabcontent">
				<h2>Кнопки</h2>
				<p>
					Эти 2 кнопки работают как брейкпоинты с условием.
				</p>
				<p>
					<img src="8.png">
				</p>
				<p class="tip">
					Подробнее читай в статье с кнопками.
				</p>
				<h3>Step Out</h3>
				<p>
					Выполнение оставшегося кода в текущей подпрограмме и выход из нее.
				</p>
				<h3>Step Over</h3>
				<p>
					Выполнение кода внутри подпрограммы (инструкция <text class="opcode">JSR</text>) по адресу кнопки Seek PC и выход из нее.
				</p>
			</div>
		</p>
		<script src="https://cyneprepou4uk.github.io/iromhacker/spoiler.js"></script>
		<script src="https://cyneprepou4uk.github.io/iromhacker/tab.js"></script>
	</body>
</html>