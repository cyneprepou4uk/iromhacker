<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html">
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<title>ЯРомхакеръ. Ромхакинг NES. Центральный процессор. Основные режимы адресации процессора 6502</title>
		<meta name="description" content="Подробное описание режимов адресации Immediate, Zero Page и Absolute">
		<meta name="keywords" content="">
		<link rel="icon" href="https://iromhacker.ru/favicon.png" type="image/png">
		<link href="https://iromhacker.ru/style.css" rel="stylesheet">
		<script src="https://iromhacker.ru/analytics.js"></script>
		<script src="https://iromhacker.ru/bitrix24.js" async></script>
	</head>
	<body>
		<h1>Основные режимы адресации</h1>
		<p>
			<center>
				<a href="https://iromhacker.ru/nes/ru/index.html">Вернуться на главную страницу</a>
			</center>
		</p>
		<br>
		<p class="content">
			Содержание
		</p>
		<ul>
			<li><a href="../1/index.html">Справочник по инструкциям процессора</a></li>
			<li>Режимы адресации</li>
			<ul>
				<li>Дополнительные режимы адресации</li>
				<li>Прочие режимы адресации</li>
			</ul>
		</ul>
		<h2>Режимы адресации</h2>
		<p>
			Режим адресации (адресация памяти) - способ обращения процессора к своей памяти.
		</p>
		<p>
			Любая инструкция процессора состоит как минимум из опкода инструкции. В зависимости от выбранного режима адресации, после опкода может быть дополнительно записан операнд (аргумент) этой инструкции размером 1 или 2 байта. В итоге получается инструкция размером от 1-го до 3-х байтов.
		</p>
		<p class="tip">
			Разные инструкции могут использовать один и тот же режим адресации. У одних инструкций может быть больше выбора режимов адресации, чем у других.
		</p>
		<p>
			Кликни на режим адресации, чтобы посмотреть информацию по ней.
		</p>
		<p>
			<table class="tab" border=1 cellspacing=1 cellpadding=5>
				<tr>
					<td>Основные</td>
					<td class="tabLink" onclick="openTab(event, 'Immediate')">Immediate</td>
					<td class="tabLink" onclick="openTab(event, 'Zero Page')">Zero Page</td>
					<td class="tabLink" onclick="openTab(event, 'Absolute')">Absolute</td>
				</tr>
				<tr>
					<td>Дополнительные</td>
					<td class="tabLink" onclick="openTab(event, 'Indexed')">Indexed</td>
					<td colspan="2">Indirect</td>
				</tr>
				<tr>
					<td>Прочие</td>
					<td>Relative</td>
					<td>Accumulator</td>
					<td>Implied</td>
				</tr>
			</table>
		</p>
		<div id="Immediate" class="tabcontent">
			<h2>Immediate</h2>
			<p>
				Непосредственная адресация. Используется для работы с константами, то есть с неизменяемыми значениями, записанными в самой программе. Например, можно задать начальное количество жизней и прочитать его одним из регистров.
			</p>
			<p>
				Операнд инструкции размером 1 байт, им указывается константа, с которым будет работать эта инструкция.
			</p>
			<p>
				<div class="debugger_code">
					<div class="debugger_string">00:8100: A0 0F     <text class="opcode">LDY #</text><text class="address">$0F</text>	; загрузить байт #$0F в регистр Y</div>
					<div class="debugger_string">00:8102: E0 33     <text class="opcode">CPX #</text><text class="address">$33</text>	; сравнить регистр X с байтом #$33</div>
					<div class="debugger_string">00:8104: 69 1C     <text class="opcode">ADC #</text><text class="address">$1C</text>	; сложить регистр A с байтом #$1C</div>
				</div>
			</p>
			<p class="tip">
				Чтобы инструкция LDY использовала режим адресации Immediate, она записывается с помощью опкода A0. А чтобы загрузить в регистр Y байт #$0F, после опкода ставится операнд 0F.
			</p>
		</div>
		<div id="Zero Page" class="tabcontent">
			<h2>Zero Page</h2>
			<p>
				Адресация нулевой страницы. Нулевой страницей являются адреса RAM в диапазоне $0000-$00FF. Старший байт адресов этого диапазона = #$00, поэтому страница называется "нулевая".
			</p>
			<p>
				Эта 8-битная адресация служит для экономии ресурсов процессора, поскольку затрачивает меньше тактов на выполнение инструкции по сравнению с режимом адресации Absolute.
			</p>
			<p class="tip">
				По этой причине данные, которые будут использованы кодом игры чаще, чем другие, обычно находятся именно в нулевой странице, чтобы снизить нагрузку на процессор при регулярной работе с этими данными. За счет сэкономленных тактов можно успеть выполнить больше кода за 1 кадр.
			</p>
			<p>
				Операнд инструкции размером 1 байт, им указывается младший байт адреса. А старший байт адреса всегда будет = #$00.
			</p>
			<p>
				<div class="debugger_code">
					<div class="debugger_string">00:8100: 85 4D     <text class="opcode">STA</text> <text class="address">$4D</text>    ; записать байт из регистра A в адрес $004D</div>
					<div class="debugger_string">00:8102: C6 03     <text class="opcode">DEC</text> <text class="address">$03</text>    ; уменьшить на #$01 байт в адресе $0003</div>
					<div class="debugger_string">00:8104: 45 A1     <text class="opcode">EOR</text> <text class="address">$A1</text>    ; исключающее ИЛИ байта из регистра A и байта из адреса $00A1</div>
				</div>
			</p>
			<p class="tip">
				Чтобы инструкция STA использовала режим адресации Zero Page, она записывается с помощью опкода 85. А чтобы записать байт из регистра A в адрес $004D, после опкода ставится операнд 4D.
			</p>
		</div>
		<div id="Absolute" class="tabcontent">
			<h2>Absolute</h2>
			<p>
				Абсолютная адресация. Полноценная 16-битная адресация, позволяет инструкциям работать с любым адресом памяти процессора (NES Memory) в диапазоне $0000-$FFFF.
			</p>
			<p>
				Операнд инструкции размером 2 байта, им указывается 16-битный адрес. Из-за особенностей архитектуры процессора, в операнде старший и младший байты адреса <text class="underline">всегда</text> записываются в обратном порядке, такой формат называется <a href="https://ru.wikipedia.org/wiki/%D0%9F%D0%BE%D1%80%D1%8F%D0%B4%D0%BE%D0%BA_%D0%B1%D0%B0%D0%B9%D1%82%D0%BE%D0%B2#%D0%9F%D0%BE%D1%80%D1%8F%D0%B4%D0%BE%D0%BA_%D0%BE%D1%82_%D0%BC%D0%BB%D0%B0%D0%B4%D1%88%D0%B5%D0%B3%D0%BE_%D0%BA_%D1%81%D1%82%D0%B0%D1%80%D1%88%D0%B5%D0%BC%D1%83" target="_blank">little-endian</a>.
			</p>
			<p>
				<div class="debugger_code">
					<div class="debugger_string">00:8100: AE 23 01  <text class="opcode">LDX</text> <text class="address">$0123</text>    ; загрузить в регистр X байт из адреса $0123</div>
					<div class="debugger_string">00:8103: 0E 45 03  <text class="opcode">ASL</text> <text class="address">$0345</text>    ; арифметический сдвиг битов влево у байта в адресе $0345</div>
					<div class="debugger_string">00:8106: ED 09 00  <text class="opcode">SBC</text> <text class="address">$0009</text>    ; вычесть из регистра A байт из адреса $0009</div>
				</div>
			</p>
			<p class="tip">
				Чтобы инструкция LDX использовала режим адресации Absolute, она записывается с помощью опкода AE. А чтобы загрузить в регистр X байт из адреса $0123, после опкода ставится операнд 23 01.
			</p>
			<p class="tip">
				У инструкции SBC для указания адреса $0009 была выбрана абсолютная адресация, что потребует 4 такта на выполнение этой инструкции. Можно было бы получить точно такой же результат и сэкономить 1 такт, записав инструкцию как E5 09 для использования адресации нулевой страницы.
			</p>
		</div>
		<div id="Indexed" class="tabcontent">
			<h2>Indexed</h2>
			<p>
				Индексная адресация. При вычислении адреса учитывается значение индексного регистра X или Y. К адресу, указанному в операнде инструкции, добавляется текущее значение индексного регистра во время выполнения инструкции. После сложения операнда и индексного регистра получается итоговый адрес, с которым будет работать инструкция.
			</p>
			<p class="tip">
				Инструкция, работающая с индексным регистром, не может использовать этот же регистр для режима индексной адресации. То есть не существует инструкций вроде LDX,X или LDY,Y.
			</p>
			<p>
				Поскольку значение индексного регистра может быть в диапазоне от #$00 до #$FF, при помощи одной-единственной инструкции можно обратиться к целому диапазону размером 256 байтов, изменяя значение индексного регистра перед выполнением этой инструкции.
			</p>
			<p class="tip">
				Этот подход очень часто применяется при создании циклов и подпрограмм. А также индексная адресация - одна из наиболее важных причин, почему однотипные адреса у различных игровых объектов, например их координаты, очень часто находятся в RAM по соседству.
			</p>
			<p>
				Индексная адресация может быть использована как с режимом адресации Zero Page, так и Absolute. У некоторых инструкций есть ограничение по выбору этих разновидностей индексной адресации, в основном ограничения по использованию регистра Y.
			</p>
			<p class="tip">
				Также индексная адресация может использоваться с режимом адресации Indirect, которая описана ниже.
			</p>
			<h3>Zero Page Indexed</h3>
			<p>
				Поскольку указывается адрес нулевой страницы, операн инструкции должен быть размером 1 байт.
			</p>
			<div class="debugger_code">
				<div class="debugger_string">00:8100: A9 10     <text class="opcode">LDA #</text><text class="address">$10 </text>    ; загрузить байт #$10 в регистр A</div>
				<div class="debugger_string">00:8102: A2 00     <text class="opcode">LDX #</text><text class="address">$00 </text>    ; загрузить байт #$00 в регистр X</div>
				<div class="debugger_string">00:8104: 95 99     <text class="opcode">STA</text> <text class="address">$99</text><text class="opcode">,X</text>    ; записать байт из регистра A в адрес $0099</div>
				<div class="debugger_string">00:8106: E8        <text class="opcode">INX</text>          ; увеличить байт в регистре X на #$01</div>
				<div class="debugger_string">00:8107: 95 99     <text class="opcode">STA</text> <text class="address">$99</text><text class="opcode">,X</text>    ; записать байт из регистра A в адрес $009A</div>
				<div class="debugger_string">00:8109: E8        <text class="opcode">INX</text>          ; увеличить байт в регистре X на #$01</div>
				<div class="debugger_string">00:810A: 95 99     <text class="opcode">STA</text> <text class="address">$99</text><text class="opcode">,X </text>   ; записать байт из регистра A в адрес $009B</div>
			</div>
			<p class="tip">
				Чтобы инструкция STA использовала режим адресации Zero Page Indexed, она записывается с помощью опкода 95. А чтобы записать байт из регистра A в адрес $0099,X, после опкода ставится операнд 99.
			</p>
			<p class="tip">
				Изменяя байт в регистре X, изменится и итоговый адрес, в который будет записан байт из регистра A.
			</p>
			<p class="tip">
				Нельзя выйти за пределы нулевой страницы, используя адресацию Zero Page Indexed. Например, выполняя инструкцию STA $FF,X с текущим значением X = #$01, байт из регистра A будет записан в адрес $0000, а не $0100.
			</p>
			<h3>Absolute Indexed</h3>
			<p>
				Косвенная адресация.
			</p>
		</div>
		<script src="https://iromhacker.ru/spoiler.js"></script>
		<script src="https://iromhacker.ru/tab.js"></script>
	</body>
</html>