<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html">
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<title>Ромхакинг NES. Центральный процессор 6502</title>
		<meta name="description" content="Подробное описание характеристик процессора. A detailed description of CPU specifications">
		<meta name="keywords" content="">
		<link rel="icon" href="https://cyneprepou4uk.github.io/iromhacker/favicon.png" type="image/png">
		<link href="https://cyneprepou4uk.github.io/iromhacker/style.css" rel="stylesheet">
		<script src="https://cyneprepou4uk.github.io/iromhacker/analytics.js"></script>
	</head>
	<body>
		<h1>Центральный процессор</h1>
		<p>
			<center>
				<a class="return" href="https://cyneprepou4uk.github.io/iromhacker/nes/ru/index.html">Вернуться на главную страницу</a>
			</center>
		</p>
		<p class="content">
			Содержание
		</p>
		<ul>
			<li>Центральный процессор</li>
			<ul>
				<li><a href="../1-1/index.html">Регистр статуса процессора</a></li>
				<li><a href="../1-2/index.html">Режимы адресации</a></li>
			</ul>
			<li><a href="../2/index.html">Справочник по инструкциям процессора</a></li>
			<ul>
				<li><a href="../2-1/index.html">Шпаргалка по инструкциям</a></li>
			</ul>
		</ul>
		<h2>Центральный процессор</h2>
		<p class="tip">
			Мелкие детали можно прочитать на <a href="http://wiki.nesdev.com/w/index.php/CPU_ALL" target="_blank">NesDev</a>.
		</p>
		<p>
			Центральным процессором (CPU - Central Processing Unit) для NES является 8-битный микропроцессор на основе MOS Technology 6502. Версия процессора RP2A03 для региона NTSC и RP2A07 для региона PAL.
		</p>
		<p>
			За 1 кадр процессор успевает выполнить инструкций на сумму 29780/33247 тактов для NTSC/PAL (с небольшой погрешностью для обоих регионов).
		</p>
		<p>
			Размер шины данных = 8 бит. Это означает, что за 1 раз процессор может обработать данные размером 1 байт. Отсюда и "8-bit" в названии игровой консоли.
		</p>
		<p>
			Размер адресной шины = 16 бит. Она позволяет процессору обращаться к любому адресу своей памяти из диапазона $0000-$FFFF. Для обращения к памяти существует несколько различных способов.
		</p>
		<p class="tip">
			Подробнее про эти способы читай в подразделе с режимами адресации. 
		</p>
		<h3>Прочая информация </h3>
		<p>
			Выбери раздел из списка для прочтения информации по нему.
		</p>
		<p class="tip">
			Раздел еще в разработке, ссылки будут добавлены постепенно.
		</p>
		<p>
			<table border=1 cellspacing=1 cellpadding=5>
				<tr>
					<td class="tabLink" onclick="openTab(event, 'Registers')">Регистры процессора</td>
					<td class="tabLink" onclick="openTab(event, 'Memory')">Память процессора</td>
					<td>Язык программирования</td>
					<td>Reset</td>
				</tr>
			</table>
		</p>
		<p>
			<div id="Registers" class="tabcontent">
				<h2>Регистры процессора</h2>
				<p>
					Регистр - ячейка сверхбыстрой оперативной памяти процессора, У процессора есть пять 8-битных и один 16-битный регистр. Их текущие значения можно посмотреть/изменить в Debugger'е.
				</p>
				<p>
					<img src="1.png">
				</p>
				<p class="tip">
					Несмотря на ограниченное количество основных регистров (A, X и Y), с их помощью можно написать практически любой код.
				</p>
				<h3>Accumulator</h3>
				<p>
					8-битный регистр A (Аккумулятор). Является наиболее часто используемым регистром по сравнению с регистрами X и Y. Служит для хранения и передачи байта, а также для арифметических и битовых операций с этим байтом.
				</p>
				<h3>Index X</h3>
				<p>
					8-битный индексный регистр X. В основном используются для получения доступа к диапазону адресов посредством индексной адресации, где значение индексного регистра добавляется к операнду инструкции для вычисления адреса. Может служить просто для хранения и передачи байта.
				</p>
				<h3>Index Y</h3>
				<p>
					8-битный индексный регистр Y. В основном используются для получения доступа к диапазону адресов посредством индексной адресации. Может служить просто для хранения и передачи байта.
				</p>
				<p>
					Возможности регистра Y ограничены по сравнению с X. Y применяется в тех случаях, когда в подпрограмме оба регистра используются одновременно, и теоретически X можно использовать с любыми другими инструкциями.
				</p>
				<p>
					Например, только регистр X может быть использован в инструкциях <text class="opcode">INC</text> и <text class="opcode">DEC</text> с режимом индексной адресации, тогда Y может отвечать за загрузку байтов из таблицы данных и быть условием выхода из цикла.
				</p>
				<h3>Stack Pointer</h3>
				<p>
					8-битный регистр указателя стека. Указатель является 16-битным адресом, но старший байт этого адреса всегда = #$01, поэтому адреса стека находятся в диапазоне $0100-$01FF.
				</p>
				<p class="tip">
					Немного больше подробностей про стек читай в подразделе с памятью процессора.
				</p>
				<p>
					Указатель стека служит для хранения адреса, в который будет помещен следующий байт при использовании стека. Адрес указателя изменяется при выполнении инструкций, работающих со стеком.
				</p>
				<h3>Program Counter</h3>
				<p>
					16-битный регистр, в котором находится адрес памяти процессора. Он служит для хранения адреса текущей выполняемой инструкции.
				</p>
				<h3>Status Register</h3>
				<p>
					8-битный регистр статуса процессора, каждый бит отображает состояние одного флага.
				</p>
				<p class="tip">
					Подробнее про флаги читай в подразделе с регистром статуса процессора.
				</p>
			</div>
		</p>
		<p>
			<div id="Memory" class="tabcontent">
				<h2>Память процессора</h2>
				<p>
					Размер памяти процессора = 64 KB, это диапазон адресов $0000-$FFFF. В каждом адресе хранится 1 байт.
				</p>
				<p>
					Память поделена на несколько участков. Диапазон $4018-$4FFF не используется.
				</p>
				<h3>RAM</h3>
				<p>
					Оперативная память = 2 KB в диапазоне $0000-$07FF. В ней хранятся динамические данные для работы кода. 3 зеркала RAM находятся в диапазоне $0800-$1FFF.
				</p>
				<p>
					RAM поделена на 8 страниц, каждая страница размером 256 байтов, отсчет начинается с 0. Это диапазоны $0?00-$0?FF, например $0400-$04FF - 4-я страница. Страница $0000-$00FF называется нулевая (Zero Page).
				</p>
				<h4>Stack</h4>
				<p>
					Адреса стека в диапазоне $0100-$01FF. Стек в основном служит для хранения адресов возврата из подпрограмм и прерываний процессора, например при выполнении инструкуции <text class="opcode">JSR</text>.
				</p>
				<p>
					В стеке можно временно сохранять некоторые данные (инструкции <text class="opcode">PHA</text> и <text class="opcode">PHP</text>), а затем копировать их оттуда (инструкции <text class="opcode">PLA</text> и <text class="opcode">PLP</text>) по принципу "последний зашел - первый вышел".
				</p>
				<p class="tip">
					Подробнее про работу стека читай в разделе и инструкциями процессора. Еще можно посмотреть в <a href="https://ru.wikipedia.org/wiki/%D0%A1%D1%82%D0%B5%D0%BA" target="_blank">Википедии</a>.
				</p>
				<p>
					Адреса стека могут быть использованы просто как любые другие адреса RAM для хранения динамических данных.
				</p>
				<h4>Sprite Memory</h4>
				<p>
					Размер данных для спрайтов = 256 байтов, обычно в диапазоне $0200-$02FF. Эти данные будут ежекадрово скопированы в память спрайтов (OAM Memory), что позволит спрайтам отображаться на экране и изменять их положение относительно фона.
				</p>
				<p class="tip">
					Подробнее про спрайты узнаешь в разделе с графикой на главной странице сайта.
				</p>
				<h3>Регистры</h3>
				<p>
					В отличие от личных регистров процессора, эти регистры находятся в NES Memory и имеют какой-то реальный адрес. Через регистры передаются параметры для управления устройством.
				</p>
				<p class="tip">
					Подробнее про эти регистры узнаешь в соответствующих разделах на главной странице сайта.
				</p>
				<h4>Видеопроцессор</h4>
				<p>
					$2000-$2007 - регистры видеопроцессора. Зеркала регистров $2008-$3FFF.
				</p>
				<p>
					К регистрам видеопроцессора также относится адрес $4014.
				</p>
				<h4>Аудиопроцессор</h4>
				<p>
					Диапазон $4000-$4013 и адрес $4015 - регистры аудиопроцессора. 
				</p>
				<h4>Порты I/O</h4>
				<p>
					Порты ввода/вывода по адресам $4016-$4017. Служат для чтения управления с джойстиков.
				</p>
				<h4>Прочие регистры</h4>
				<p>
					Некоторые адреса из диапазона $5000-$5FFF могут быть использованы как дополнительные регистры с различным предназначением на некоторых мапперах.
				</p>
				<p class="tip">
					Подробнее про мапперы узнаешь в соответствующих разделах на главной странице сайта.
				</p>
				<h3>SRAM</h3>
				<p>
					$6000-$7FFF - адреса батарейки (Save RAM), предназначенной для сохранения данных игрового процесса на микросхеме картриджа. Обычно используется в RPG-играх. Адреса могут быть использованы как дополнительная RAM для хранения динамических данных и/или как PRG для хранения кода и статических данных.
				</p>
				<p>
					Наличие SRAM зависит от маппера. В некоторых случаях вместо SRAM может быть PRG RAM.
				</p>
				<h3>PRG ROM</h3>
				<p>
					Диапазон адресов $8000-$FFFF. Здесь находится код игры и статические данные. По этим адресам отображается та область памяти из ROM File, которую процессор "видит" в своей памяти на данный момент и с которой может работать.
				</p>
				<p>
					Некоторые мапперы позволяют переключать участки памяти размером от 8 до 32 KB, которые называются "банки". После переключения банка процессор видит в своей памяти уже другую область из ROM File, может выполнять оттуда код и считывать эти данные.
				</p>
				<p>
					Некоторые из адресов диапазона $8000-$FFFF используются как регистры для управления переключением банков памяти.
				</p>
				<h4>Векторы прерываний</h4>
				<p>
					Вектор - адрес, в котором начинается код обработчика соответствующего прерывания процессора. При срабатывании прерывания процессор переходит на адрес его обработчика и начинает выполнять код в этом месте.
				</p>
				<p>
					По этим адресам находятся младший и старший байты адреса вектора.
				</p>
				<p>
					<table border=1 cellspacing=1 cellpadding=5>
						<tr>
							<td>Прерывание</td>
							<td>Младший байт</td>
							<td>Старший байт</td>
							<td>Приоритет прерывания</td>
						</tr>
						<tr>
							<td>NMI</td>
							<td>$FFFA</td>
							<td>$FFFB</td>
							<td>Средний</td>
						</tr>
						<tr>
							<td>Reset</td>
							<td>$FFFC</td>
							<td>$FFFD</td>
							<td>Высокий</td>
						</tr>
						<tr>
							<td>IRQ/BRK</td>
							<td>$FFFE</td>
							<td>$FFFF</td>
							<td>Низкий</td>
						</tr>
					</table>
				</p>
				<p class="tip">
					Подробнее про NMI и IRQ прочитаешь в разделах с видеопроцессором. BRK будет описан в инструкциях процессора.
				</p>
			</div>
		</p>
		<p>
			<div id="Reset" class="tabcontent">
				<h2>Reset</h2>
			</div>
		</p>
		</p>
		<p>
			<div id="Assembly" class="tabcontent">
				<h2>Язык программирования</h2>
			</div>
		</p>
		<script src="https://cyneprepou4uk.github.io/iromhacker/spoiler.js"></script>
		<script src="https://cyneprepou4uk.github.io/iromhacker/tab.js"></script>
	</body>
</html>